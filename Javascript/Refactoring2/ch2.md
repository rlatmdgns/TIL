# ch2

# 리팩토링 정의

- 코드를 이해하고 수정하기 쉽도록 내부 구조를 변경하는 기법
- 동작을 보존하는 작은 단계들을 거쳐 코드를 수정하고 이러한 단계들을 순차적으로 연결하여 변화를 만들어 내는 일.
- 리팩터링하는 동안에는 코드가 항상 정상 작동하기 때문에 언제든 멈출 수 있다.

## 두 개의 모자

개발 할 때 목적이 **기능 추가 or 리팩터링이냐**를 명확하게 구분하여 작업

- 기능을 추가할 때는 기존 코드는 절대 건드리지 않고 새기능을 추가하기만 한다.
- 리팩터링할 때는 기능 추가는 절대 하지 않기, 코드 재구성에만 전념

> 새 기능을 추가하다 보면 코드 구조를 바꿔야 작업하기 쉽다는 생각이 들기도한다. 그때는 잠시 모자를 바꿔쓰고 리팩토링한다. 코드 구조가 어느 정도 개선되면 다시 기능추가를 이어한다. 내가 쓰고 있는 모자가 무엇인지 그에 따른 미묘한 작업 방식의 차이를 인식한다.

## 리팩터링을 하는 이유

래픽터링이 만병 통치약은 아니다 !

- 리팩터링을하면 소프트웨어 설계가 좋아진다.
  - 코드 구조를 지탱 !
  - 중복 코드 제거 → 설계 개선 작업의 중요한 축을 차지한다.
  - 이해할 코드량이 줄어듬
- 소프트웨어를 이해하기 쉬어짐
  - 코드를 더 잘읽히게 도와줌.
  - 목적과 의도가 드러난 코드
- 버그를 쉽게 찾을 수 있다.
  - 견고한 코드를 작성하는데 효과적
- 프로그래밍 속도를 높일 수 있다.
  - 내부 설계와 가독성이 개선되고 버그가 줄어든다.
  - 내부 설계가 잘 된 소프트웨어는 새로운 기능을 추가할 지점과 어떻게 고칠지 쉽게 찾을 수 있음.
  - 디버깅 쉽고, 새 기능 구축을 돕는 견고한 토대가된다.

## 언제 리팩터링해야 할까?

- 3의 법칙
  - 처음에는 그냥한다.
  - 비슷한 일을 두 번째로 하게되면, 일단 계속 진행
  - 비슷한 일을 세 번째 하게되면 리팩터링 !!
- 기능을 쉽게 추가하게 만들기
  - 리팩터링 가장 좋은 시점 - 기능을 새로 추가하기 직전
- 코드를 이해하기 쉽게 만들기
  - 적절한 네이밍
  - 긴 함수를 잘게 나누기
- 쓰레기 줍기 리팩토링
  - 시간이 좀 걸리는 일은 짧은 메모 남기기
  - 하던 일 끝내고 나서 처리
- 계획된 리팩터링과 수시로 하는 리팩터링
- **코드 리뷰**를 통한 리팩토리
- 리팩터링하지 말아야할 때
  - 처음부터 새로 작성하는 게 쉬울 때
  - 지저분한 코드

> 개발에 들어가기 전에 리팩터링 일정을 잡아주지 않는다, 기능을 추가하거나 버그를 잡는 동안 함께한다.
> 오래 걸리는 리팩터링은 조금씩 해결해나간다.

<aside>
💡 보기 싫은 코드를 발견하면 리팩터링하자, 잘 작성 된 코드 역시 수많은 리팩터링을 거친다.

</aside>

## 리팩터링 시 고려할 문제

> 리팩터링의 궁극적인 목적은 개발 속도를 높여서, 더 적은 노력으로 많은 가치를 창출하는 것.

- 새 기능 개발 속도 저하
- 코드 소유권 (소유권이 나뉘어있으면 리팩터링 방해) 팀단위
- 브랜치는 자주 통합되어야 리팩터링에 좋다.
- 성공/실패 여부를 판단하는 테스트 코드 작성.
- 레거시 코드가 있다면 테스트 작성부터.
  - 테스트 코드가 없다면 그것은 레거시 코드다.

## **리팩터링, 아키텍처, 애그니(YAGNI)**

- 모든 상황을 고려하면 변화에 대응하는 능력이 떨어진다.

  - 현재 요구사항만 멋지게 해결하도록 설계!.
  - 진행하면서 요구사항을 알게 된다면 그에 맞게 리팩터링하자.
  - 리팩터링을 미루면 훨씬 힘들어 진다는 확신이 들때만 유연성 메커니즘을 미리 추가한다..
  - **YAGNI** (you aren't going to need it) _정말 필요할 때까지 그 기능을 만들지 말라._
  - 간결한 설계와 점진적 설계의 균형.
  - 진화형 아키텍처
    - 아키텍처 관련 결정 시간을 두고 반복해 내릴 수 있다는 장점을 활용하는 패턴과 실천법을 추구

  ## **리팩터링과 소프트웨어 개발 프로세스**

  - 익스트림 프로그래밍이란, 지속적 통합(CI), 자가 테스트 코드, 리팩터링 등의 기법들을 묶은 프로세스다.
  - 자가 테스트 코드와 리팩터링을 묶어서 테스트 주도 개발(TDD)라 칭한다.
  - 리팩터링의 첫 번째 토대는 자가 테스트 코드다.
  - CI를 통해 팀원간의 코드가 계속 통합되어야 높은 효과가 있다.
  - 자가 테스트 코드 + CI + 리팩터링 => 애그니 가능
  - 자가 테스트 코드 + CI + 리팩터링 => 배포 주기를 짧게 가져갈 수 있도록 만들어준다.

  ## **리팩터링과 성능**

  - 리팩터링을 하면 성능을 좋게 만들기 쉬워진다.
  - 추측만으로 성능에 대해 판단하지않기.
  - 대부분은 프로그램은 극히 일부 구간에서 많은 시간을 소비한다. 코드 전체를 최적화한다면 효과는 거의 없고 코드만 덜 명료해질 뿐이다.
  - 의도적으로 성능 최적화에 돌입하기 전에는 성능에 신경쓰지 말고 코드를 다루기 쉽게 만드는데 집중
